<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Dashboard</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="build/react.js"></script>
    <script src="build/JSXTransformer.js"></script>
    <script src="dashboard.jsx" type="text/jsx"></script>
</head>
<body>
<header class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand"
               href="https://github.com/lowsky/dashboard/">Dashboard</a>
        </div>
    </div>
</header>
<div class="container-fluid">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h1>Main</h1>
        </div>
        <div class="panel-body">
            <table class="table table-striped table-bordered table-condensed">
                <thead>
                <tr>
                    <th>Git branch</th>
                    <th>GitHub</th>
                </tr>
                </thead>
                <tbody id="branchesTable">
                </tbody>
            </table>
        </div>
    </div>
</div>
<script type="text/jsx">

    function updateBranches(branches) {
        var branchesTable = document.getElementById('branchesTable');

        React.render(
            <tbody>
                {branches.map(renderBranchRow)}
            </tbody>,
            branchesTable);

    }

    var repo = 'lowsky/dashboard';

    function requestAndShowBranches() {
        var url = 'https://api.github.com/repos/' + repo + '/branches';
        var request = new XMLHttpRequest();
        request.open('GET', url, true);
        request.onload = function () {
            if (request.status >= 200 && request.status < 400) {
                var data = JSON.parse(request.responseText);
                updateBranches(data);
            } else {
                alert('Load error, while trying to retrieve data from ' + url +
                    ' Server respond: ' + request.responseText);
            }
        };
        request.onerror = function () {
            console.error(request);
            alert('Load error, while trying to retrieve data from ' + url);
        };
        return request;
    }

    requestAndShowBranches().send();

</script>
</body>
</html>
